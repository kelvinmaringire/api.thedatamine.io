pip freeze > requirements.txt

su - root

sudo timedatectl set-timezone Africa/Johannesburg

sudo apt update

sudo apt upgrade -y

sudo ufw enable

sudo ufw allow 80/tcp

sudo ufw allow 8000/tcp

sudo ufw allow 443/tcp

sudo ufw reload

sudo ufw status

sudo apt install nginx -y

sudo nginx -t   #test conf

sudo service nginx start

sudo systemctl restart nginx

sudo apt install build-essential libpq-dev python3-dev python3-venv cron -y

sudo apt install postgresql postgresql-contrib -y

sudo apt install -y postgresql-common
sudo /usr/share/postgresql-common/pgdg/apt.postgresql.org.sh

sudo -i -u postgres psql

ALTER USER postgres WITH PASSWORD 'talibk700';

CREATE DATABASE thedatam_db;

GRANT ALL PRIVILEGES ON DATABASE thedatam_db TO postgres;

ALTER USER postgres WITH SUPERUSER;

\q

cd /var/www

sudo git clone https://github.com/kelvinmaringire/api.thedatamine.io.git

cd api.thedatamine.io

sudo python3 -m venv myenv

source myenv/bin/activate

sudo -u postgres psql thedatam_db < thedatam_db.sql

pip install -r requirements.txt

sudo myenv/bin/pip install -r requirements.txt -> incase


playwright install

playwright install-deps

pip install gunicorn

sudo myenv/bin/pip install gunicorn

sudo nano /etc/systemd/system/gunicorn.service

#########################

[Unit]
Description=Gunicorn instance to serve your Django app
After=network.target

[Service]
User=root
Group=www-data
WorkingDirectory=/var/www/api.thedatamine.io
ExecStart=/var/www/api.thedatamine.io/myenv/bin/gunicorn --workers 3 --bind unix:/run/gunicorn.sock thedatamine.wsgi:application

Restart=always
RestartSec=5
KillMode=mixed
TimeoutStopSec=5

[Install]
WantedBy=multi-user.target

###########################

sudo systemctl start gunicorn

sudo systemctl enable gunicorn

sudo systemctl restart gunicorn

sudo systemctl status gunicorn

sudo systemctl daemon-reload -> If you make changes to the service file, you need to reload the systemd daemon:

sudo mkdir static

sudo mkdir conf

sudo nano conf/gunicorn_config.py

####################################

command = '/var/www/api.thedatamine.io/myenv/bin/gunicorn'
pythonpath = '/var/www/api.thedatamine.io'
bind = '178.128.39.77:8000'
workers = 3

####################################

gunicorn -c conf/gunicorn_config.py thedatamine.wsgi


Ctrl Z && bg for playing in the background

sudo systemctl restart nginx

sudo nano thedatamine/settings/base.py


STATICFILES_DIRS = [
    "/var/www/api.thedatamine.io/thedatamine/static/",
]

STATIC_ROOT = "/var/www/api.thedatamine.io/static/"

MEDIA_ROOT = "/var/www/api.thedatamine.io/media/"

sudo chown -R $USER:$USER /var/www/api.thedatamine.io/static  -> incase
sudo chmod -R 755 /var/www/api.thedatamine.io/static   -> incase

python manage.py collectstatic

deactivate

sudo nano /etc/nginx/sites-available/thedatamine

###################################

server {
    listen 80;
    server_name thedatamine.online;

    location /static/ {
        alias /var/www/api.thedatamine.io/static/;
    }

    location / {
        proxy_pass http://178.128.39.77:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

##################################

cd /etc/nginx/sites-enabled/

sudo ln -s /etc/nginx/sites-available/thedatamine

sudo rm default

sudo apt install certbot python3-certbot-nginx -y

sudo certbot --nginx -d thedatamine.online

sudo systemctl restart nginx

pscp -P 22 forebet_data.json root@178.128.39.77:/var/www/api.thedatamine.io/media/documents/
pscp.exe -P 22 root@156.155.253.131:/var/www/api.thedatamine.io/media/documents/forebet_data.json C:\Users\Ring'az\Desktop
mv /root/forebet_data.json /var/www/api.thedatamine.io/media/documents/

sudo apt install cron

python manage.py crontab add

python manage.py crontab show

python manage.py crontab remove

sudo crontab -e

sudo service cron restart


* * * * * cd /var/www/api.thedatamine.io/ && source myenv/bin/activate && python manage.py runcrons "thedatabet.cron.StatsData" >> /var/www/api.thedatamine.io/logs/cron.log 2>&1


* * * * * source /root/.bashrc && source /var/www/api.thedatamine.io/myenv/bin/activate && python /var/www/api.thedatamine.io/manage.py runcrons >> /var/www/api.thedatamine.io/logs/cron.log 2>&1

* * * * * source /root/.bashrc && source /var/www/api.thedatamine.io/myenv/bin/activate && python /var/www/api.thedatamine.io/manage.py stats_data >> /var/www/api.thedatamine.io/logs/cron.log 2>&1


53 2 * * * cd /var/www/api.thedatamine.io/ && source myenv/bin/activate && python manage.py stats_data >> /var/www/api.thedatamine.io/logs/cron.log.log 2>&1
 /tmp/crontab.Pqwz3l/crontab
tail -f /var/log/syslog

tail -f /var/www/api.thedatamine.io/logs/cron.log


rm -r /path/to/folder
pwd -> current working directory


Database

sudo nano /etc/postgresql/14/main/pg_hba.conf

local   all             postgres                                peer
To
local   all             postgres                                md5

pg_dump -U postgres -F c -b -v -f backup.sql thedatam_db

Database in local

\q

cd C:\Users\Ring'az\Documents\Apps\api.thedatamine.io

"C:\Program Files\PostgreSQL\15\bin\psql.exe" -h localhost -p 5432 -U postgres -d thedatam_dbb -f thedatam_db_140824.sql
